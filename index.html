<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zodiac Starmap Post Generator â€” @The_Vanallenbelt</title>

<!--
===========================================================
ZODIAC STARMAP POST GENERATOR (single-file)
-----------------------------------------------------------
How to use:
 - Edit text using the form controls on the left/top.
 - Choose a Theme preset to change colors.
 - Click "Download PNG (1080)" to export a 1080Ã—1080 image.
 - Click "Download High-Res (3000)" for a printable 3000Ã—3000 PNG.
 - Toggle options (show labels / constellation lines) as desired.

How to change defaults or style:
 - CSS custom properties are declared in :root and in theme classes.
 - Change --accent, --bg1, --bg2, --star-color, etc. to alter appearance.
 - The SVG drawing area uses viewBox="0 0 1080 1080" so exported images
   will be pixel-perfect at 1080Ã—1080 when rasterized.

Notes on astronomy:
 - This is a visual/marketing generator â€” star positions are approximate
   (procedural demo + small embedded sample star list). Not for navigation.
 - To extend star catalog: see the `STAR_CATALOG` array in the JS.
===========================================================
-->

<style>
  :root{
    --card-size:1080px;
    --bg1: #07030a;
    --bg2: #0b1530;
    --accent: #ff66d6;
    --star-color: #ffd;
    --muted: #bdb8c7;
    --card-radius: 28px;
    --glass-opa: 0.14;
    --headline-size: 44px;
    --subheadline-size: 18px;
    --caption-size: 20px;
    --badge-bg: rgba(255,255,255,0.08);
    --cta-bg: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  }

  /* Theme presets */
  .theme-galaxy  { --bg1:#050014; --bg2:#1b0536; --accent:#e84cff; --star-color:#ffd; }
  .theme-mystic  { --bg1:#001426; --bg2:#002b4a; --accent:#00e5ff; --star-color:#dff7ff; }
  .theme-golden  { --bg1:#070707; --bg2:#1a1410; --accent:#f5c85a; --star-color:#fff1d6; }

  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  body{display:flex;gap:18px;padding:20px;background:
    radial-gradient(1200px 600px at 10% 10%, rgba(255,255,255,0.02), transparent),
    linear-gradient(180deg,var(--bg1),var(--bg2));
    color:var(--muted);
    align-items:flex-start;justify-content:center;box-sizing:border-box;}

  /* Controls panel */
  .controls{
    width:360px; max-height:92vh; overflow:auto;
    background: rgba(255,255,255,0.02);
    border-radius:14px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.03);
  }
  .controls h2{margin:6px 0 12px 0;color:var(--accent);font-size:18px}
  .field{margin-bottom:10px;display:flex;flex-direction:column;}
  .field label{font-size:13px;color:rgba(255,255,255,0.65);margin-bottom:6px}
  .field input[type="text"], .field input[type="date"], .field input[type="time"], .field textarea, select{
    padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);
    background:rgba(255,255,255,0.01); color:#fff;outline:none;
    font-size:14px; resize:vertical;
  }
  textarea{min-height:76px}
  .row{display:flex;gap:8px}
  .btn{display:inline-block;padding:8px 12px;border-radius:10px;border:none;cursor:pointer;background:var(--accent);color:#05020a;font-weight:600}
  .mutebtn{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted)}
  .theme-presets{display:flex;gap:8px;margin-bottom:8px}
  .theme-presets button{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);cursor:pointer}

  /* Canvas/Card container */
  .canvas-wrap{width:540px; height:540px; display:flex; align-items:center; justify-content:center;
    perspective:1000px;}
  .card{
    width:calc(var(--card-size)/2); height:calc(var(--card-size)/2);
    border-radius:calc(var(--card-radius)/2);
    box-shadow: 0 12px 40px rgba(0,0,0,0.6), inset 0 -2px 30px rgba(255,255,255,0.02);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008));
    padding:12px;
    transform-origin:center center;
    transition:transform .45s ease, box-shadow .2s ease;
  }
  .card:hover{transform:translateY(-6px) scale(1.01)}
  /* The SVG sits full-size inside */
  svg#postSVG{width:100%;height:100%;display:block;border-radius:inherit;overflow:visible;background:
    radial-gradient(800px 600px at 20% 20%, rgba(255,255,255,0.03), transparent),
    linear-gradient(180deg,var(--bg1),var(--bg2)); border-radius:inherit; }

  /* overlay UI inside SVG is styled by attributes/classes on SVG elements */

  /* footer controls */
  .footer-actions{display:flex;gap:8px; margin-top:12px;}
  .small{font-size:13px;padding:6px 8px;border-radius:8px}

  /* tiny helper */
  .muted-note{font-size:12px;color:rgba(255,255,255,0.45);margin-top:8px}
  a.link{color:var(--accent);text-decoration:none}
</style>
</head>
<body class="theme-galaxy">

  <div class="controls" role="region" aria-label="Post editor controls">
    <h2>Zodiac Starmap â€” Editor</h2>

    <!-- Editable fields -->
    <div class="field">
      <label for="username">Username</label>
      <input id="username" type="text" value="@The_Vanallenbelt" />
    </div>

    <div class="field">
      <label for="headline">Headline (single-line)</label>
      <input id="headline" type="text" value="Your Personal Zodiac Starmap âœ¨" />
    </div>

    <div class="field">
      <label for="subheadline">Subheadline</label>
      <input id="subheadline" type="text" value="A snapshot of the stars on your special day" />
    </div>

    <div class="field">
      <label for="caption">Caption / Fact (visible up to 2 lines)</label>
      <textarea id="caption">Did you know? Jupiter shields Earth by pulling away asteroids ðŸŒŒ</textarea>
    </div>

    <div class="row" style="margin-bottom:8px">
      <div style="flex:1" class="field">
        <label for="badge">Badge</label>
        <input id="badge" type="text" value="NEW" />
      </div>
      <div style="width:120px" class="field">
        <label for="cta">CTA</label>
        <input id="cta" type="text" value="Get Your Starmap" />
      </div>
    </div>

    <!-- Toggles & small options -->
    <div class="row" style="align-items:center;margin-bottom:8px">
      <label style="display:flex;gap:8px;align-items:center">
        <input id="showLabels" type="checkbox" checked /> <span style="font-size:13px">Show labels</span>
      </label>
      <label style="display:flex;gap:8px;align-items:center">
        <input id="showLines" type="checkbox" checked /> <span style="font-size:13px">Constellation lines</span>
      </label>
    </div>

    <!-- Theme presets -->
    <div class="field">
      <label>Theme Presets</label>
      <div class="theme-presets">
        <button id="presetGalaxy" class="small">Galaxy Neon</button>
        <button id="presetMystic" class="small">Mystic Blue</button>
        <button id="presetGolden" class="small">Golden Night</button>
      </div>
    </div>

    <!-- Export / demo actions -->
    <div class="field">
      <label>Export</label>
      <div class="footer-actions">
        <button id="download1080" class="btn">Download PNG (1080)</button>
        <button id="download3k" class="mutebtn small">Download 3000</button>
        <button id="openNewTab" class="mutebtn small">Open 1080 in new tab</button>
      </div>
      <div class="muted-note">If download fails on some browsers, use "Open 1080 in new tab" then right-click â†’ Save image.</div>
    </div>

    <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0" />

    <div style="font-size:13px;color:rgba(255,255,255,0.6);line-height:1.3">
      <strong>Quick facts</strong>
      <ul>
        <li>Edit text fields and watch the preview update live.</li>
        <li>Stars & lines are drawn procedurally; labels can be toggled.</li>
        <li>To add more stars, update STAR_CATALOG in the JS section of this file.</li>
      </ul>
    </div>
  </div>

  <!-- Canvas preview (half-size for easier editing) -->
  <div class="canvas-wrap" aria-hidden="false">
    <div class="card" role="img" aria-label="Preview of zodiac starmap post">
      <!-- SVG-based design: everything drawn inside this SVG for reliable export -->
      <svg id="postSVG" viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Zodiac starmap image">
        <defs>
          <filter id="starGlow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="3.2" result="blur"/>
            <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
          <linearGradient id="bgGrad" x1="0" x2="1">
            <stop offset="0%" stop-color="rgba(255,255,255,0.02)"></stop>
            <stop offset="100%" stop-color="rgba(255,255,255,0)"></stop>
          </linearGradient>
          <radialGradient id="vignette" cx="50%" cy="35%" r="80%">
            <stop offset="0%" stop-color="rgba(255,255,255,0.02)"/>
            <stop offset="100%" stop-color="rgba(0,0,0,0.6)"/>
          </radialGradient>

          <!-- small star symbol -->
          <g id="starSymbol">
            <circle r="1.0" cx="0" cy="0" fill="white"/>
          </g>

          <!-- subtle twinkle animation using animateTransform on tiny groups -->
          <filter id="softGlow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="2.6" result="b"/>
            <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>

        <!-- Background space: gradient + subtle noise (procedural stars created by JS) -->
        <rect x="0" y="0" width="1080" height="1080" fill="url(#bgGrad)"></rect>
        <rect x="0" y="0" width="1080" height="1080" fill="url(#vignette)" opacity="0.8"></rect>

        <!-- star layer -->
        <g id="starsLayer" filter="url(#starGlow)"></g>

        <!-- constellation lines -->
        <g id="linesLayer" stroke="rgba(255,255,255,0.12)" stroke-width="1.2" fill="none" stroke-linecap="round"></g>

        <!-- zodiac band / ecliptic arc -->
        <g id="eclipticLayer" stroke="none" fill="none"></g>

        <!-- labels -->
        <g id="labelsLayer" fill="white" font-size="14" font-family="system-ui,Segoe UI,Roboto,Arial"></g>

        <!-- card overlays (avatar, username, headline, caption, CTA, badge) -->
        <g id="overlay">
          <!-- Avatar -->
          <g id="avatarGroup" transform="translate(80,80)">
            <circle cx="0" cy="0" r="44" fill="transparent" stroke="rgba(255,255,255,0.06)" stroke-width="2"></circle>
            <circle id="avatarGlow" cx="0" cy="0" r="54" fill="none" stroke="url(#avatarGlowGradient)" stroke-width="6" opacity="0.12"></circle>
            <circle cx="0" cy="0" r="38" fill="rgba(255,255,255,0.03)"></circle>
            <text x="0" y="8" text-anchor="middle" font-size="18" fill="white" style="font-weight:700">A</text>
          </g>

          <!-- Username -->
          <text id="svgUsername" x="140" y="70" font-size="20" fill="white" font-weight="700" style="font-family:system-ui,Segoe UI,Roboto,Arial">@The_Vanallenbelt</text>

          <!-- Badge top-right of card -->
          <g id="badgeGroup" transform="translate(880,70)">
            <rect id="badgeRect" x="-6" y="-22" rx="10" ry="10" width="120" height="36" fill="rgba(255,255,255,0.04)"></rect>
            <text id="svgBadge" x="54" y="- -2" text-anchor="middle" font-size="16" fill="white" dy="8" style="font-weight:700">NEW</text>
          </g>

          <!-- Headline centered (over hero/star area) -->
          <text id="svgHeadline" x="540" y="380" text-anchor="middle" font-size="40" font-weight="800" fill="white" style="letter-spacing:0.6px">Your Personal Zodiac Starmap âœ¨</text>

          <!-- Subheadline -->
          <text id="svgSubheadline" x="540" y="410" text-anchor="middle" font-size="18" fill="rgba(255,255,255,0.85)">A snapshot of the stars on your special day</text>

          <!-- Caption box bottom-left -->
          <g id="captionGroup" transform="translate(80,900)">
            <rect x="-16" y="-56" rx="14" ry="14" width="540" height="72" fill="rgba(0,0,0,0.35)"></rect>
            <text id="svgCaption" x="8" y="-18" font-size="18" fill="white" style="font-weight:500">Did you know? Jupiter shields Earth by pulling away asteroids ðŸŒŒ</text>
          </g>

          <!-- CTA bubble bottom-right -->
          <g id="ctaGroup" transform="translate(900,920)">
            <rect x="-8" y="-34" rx="18" ry="18" width="240" height="56" fill="rgba(255,255,255,0.04)"></rect>
            <text id="svgCTA" x="112" y="-10" text-anchor="middle" font-size="18" fill="white" style="font-weight:800">Get Your Starmap</text>
          </g>

        </g>

      </svg>
    </div>
  </div>

<script>
/* ------------------------
   Configurable star catalog (sample)
   To extend: add objects with {name, ra, dec, mag}
   RA in hours (0-24), Dec in degrees (-90 to +90)
   ------------------------ */
const STAR_CATALOG = [
  // Very small sample of bright stars (approx RA/Dec)
  {name:"Sirius", ra:6.7525, dec:-16.7161, mag:-1.46},
  {name:"Canopus", ra:6.3992, dec:-52.6957, mag:-0.72},
  {name:"Arcturus", ra:14.261, dec:19.1825, mag:-0.05},
  {name:"Vega", ra:18.6156, dec:38.7837, mag:0.03},
  {name:"Capella", ra:5.2782, dec:45.9979, mag:0.08},
  {name:"Rigel", ra:5.2423, dec:-8.2016, mag:0.18},
  {name:"Betelgeuse", ra:5.9195, dec:7.4071, mag:0.5},
  {name:"Altair", ra:19.8464, dec:8.8683, mag:0.76},
  {name:"Aldebaran", ra:4.5987, dec:16.5093, mag:0.85},
  {name:"Antares", ra:16.4901, dec:-26.432, mag:1.06},
  // Add more to improve the map
];

// Simple util: convert RA(hours) / Dec(deg) to unit 3D vector (ICRS-like)
function raDecToVector(raHours, decDeg) {
  const ra = raHours * Math.PI/12.0; // hours -> radians (24h=2pi)
  const dec = decDeg * Math.PI/180.0;
  const x = Math.cos(dec) * Math.cos(ra);
  const y = Math.cos(dec) * Math.sin(ra);
  const z = Math.sin(dec);
  return {x,y,z};
}

// For visualization we render a simple stereographic projection from a chosen center (0,90deg alt = zenith).
// We'll simulate a "view center" of RA=0,Dec=+30 for aesthetic; user FOV controlled by variable
let VIEW_CENTER = {ra: 0.0, dec: 30.0}; // in hours and degrees
let FOV = 80; // degrees radius

// Convert star (RA/Dec) to screen coords in svg viewBox 0..1080
function projectStar(raHours, decDeg, viewCenter, fovDeg){
  // Convert to vectors
  const v = raDecToVector(raHours, decDeg);
  const vc = raDecToVector(viewCenter.ra, viewCenter.dec);
  // compute angle between vectors using dot product
  const dot = v.x*vc.x + v.y*vc.y + v.z*vc.z;
  // clamp for numeric
  const cosAng = Math.min(1, Math.max(-1, dot));
  const ang = Math.acos(cosAng); // radians
  const angDeg = ang * 180/Math.PI;
  // If angle > fov => off-screen
  if (angDeg > fovDeg) return null;
  // Simple azimuthal equidistant projection:
  // Find orthonormal basis around view center
  // We'll pick an arbitrary north-like vector to compute local coords
  const up = {x:0,y:0,z:1};
  // compute east = normalize(cross(up, vc))
  let east = {x: up.y*vc.z - up.z*vc.y, y: up.z*vc.x - up.x*vc.z, z: up.x*vc.y - up.y*vc.x};
  const normE = Math.hypot(east.x, east.y, east.z) || 1;
  east.x/=normE; east.y/=normE; east.z/=normE;
  // north = cross(vc, east)
  let north = {x: vc.y*east.z - vc.z*east.y, y: vc.z*east.x - vc.x*east.z, z: vc.x*east.y - vc.y*east.x};
  // coordinates in local tangent plane
  const k = Math.sin(ang)/Math.sin(ang || 1e-9);
  // However simpler: compute vector difference and dot with basis to get x,y
  const x = v.x*east.x + v.y*east.y + v.z*east.z;
  const y = v.x*north.x + v.y*north.y + v.z*north.z;
  // radial distance proportional to angle
  const r = (ang / (fovDeg * Math.PI/180)) * (480); // map fov to 480 px radius (approx)
  const sx = 540 + r * x; // center 540,540
  const sy = 540 - r * y;
  return {x:sx,y:sy,angDeg};
}

/* ------------------------
   Build procedural background stars (decorative)
   ------------------------ */
function makeBackgroundStars(n=120){
  const arr=[];
  for(let i=0;i<n;i++){
    arr.push({
      x: Math.random()*1080,
      y: Math.random()*1080,
      r: Math.random()*1.2+0.3,
      o: 0.4 + Math.random()*0.7
    });
  }
  return arr;
}

/* ------------------------
   Render function: draws stars + lines + labels + overlays
   ------------------------ */
const svg = document.getElementById('postSVG');
const starsLayer = document.getElementById('starsLayer');
const linesLayer = document.getElementById('linesLayer');
const labelsLayer = document.getElementById('labelsLayer');
const eclipticLayer = document.getElementById('eclipticLayer');

const bgStars = makeBackgroundStars(140);

function renderAll(){
  // Clear layers
  while(starsLayer.firstChild) starsLayer.removeChild(starsLayer.firstChild);
  while(linesLayer.firstChild) linesLayer.removeChild(linesLayer.firstChild);
  while(labelsLayer.firstChild) labelsLayer.removeChild(labelsLayer.firstChild);
  while(eclipticLayer.firstChild) eclipticLayer.removeChild(eclipticLayer.firstChild);

  // Draw background decorative stars
  bgStars.forEach((s,idx)=>{
    const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
    c.setAttribute('cx', s.x);
    c.setAttribute('cy', s.y);
    c.setAttribute('r', s.r);
    c.setAttribute('fill', 'white');
    c.setAttribute('opacity', s.o * 0.12);
    starsLayer.appendChild(c);
  });

  // Draw main catalog stars
  const fov = FOV;
  STAR_CATALOG.forEach(st=>{
    const p = projectStar(st.ra, st.dec, VIEW_CENTER, fov);
    if(!p) return;
    // size by magnitude (smaller mag => brighter)
    const size = Math.max(1.2, 6 - (st.mag || 2));
    const circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
    circle.setAttribute('cx', p.x);
    circle.setAttribute('cy', p.y);
    circle.setAttribute('r', size);
    circle.setAttribute('fill', 'white');
    circle.setAttribute('opacity', Math.max(0.5, 1 - ( (st.mag||2)/6 )));
    circle.setAttribute('filter','url(#softGlow)');
    starsLayer.appendChild(circle);

    // label for brightest stars (if toggled)
    if(document.getElementById('showLabels').checked && st.mag < 1.5){
      const t = document.createElementNS('http://www.w3.org/2000/svg','text');
      t.setAttribute('x', p.x + size + 6);
      t.setAttribute('y', p.y + 4);
      t.setAttribute('font-size', '12');
      t.setAttribute('fill', 'rgba(255,255,255,0.9)');
      t.textContent = st.name;
      labelsLayer.appendChild(t);
    }
  });

  // (Optional) Draw simple constellation-like connecting lines between sample stars (for demo)
  if(document.getElementById('showLines').checked){
    // naive: connect sequential stars as demo constellation
    for(let i=0;i<STAR_CATALOG.length-1;i++){
      const a = projectStar(STAR_CATALOG[i].ra, STAR_CATALOG[i].dec, VIEW_CENTER, fov);
      const b = projectStar(STAR_CATALOG[i+1].ra, STAR_CATALOG[i+1].dec, VIEW_CENTER, fov);
      if(!a || !b) continue;
      const path = document.createElementNS('http://www.w3.org/2000/svg','path');
      const d = `M ${a.x} ${a.y} L ${b.x} ${b.y}`;
      path.setAttribute('d', d);
      path.setAttribute('stroke', 'rgba(255,255,255,0.12)');
      path.setAttribute('stroke-width', '1.2');
      path.setAttribute('fill','none');
      linesLayer.appendChild(path);
    }
  }

  // Zodiac band (ecliptic) simple demonstration as an ellipse arc
  // We'll draw a faint curved arc across the sky for visual.
  const arc = document.createElementNS('http://www.w3.org/2000/svg','path');
  const r = 420;
  const cx = 540, cy = 540;
  const startAngle = -120 * Math.PI/180;
  const endAngle = 120 * Math.PI/180;
  const sx = cx + r*Math.cos(startAngle);
  const sy = cy + r*Math.sin(startAngle);
  const ex = cx + r*Math.cos(endAngle);
  const ey = cy + r*Math.sin(endAngle);
  const d = `M ${sx} ${sy} A ${r} ${r} 0 0 1 ${ex} ${ey}`;
  arc.setAttribute('d', d);
  arc.setAttribute('stroke', 'rgba(255,255,255,0.06)');
  arc.setAttribute('stroke-width', '2');
  arc.setAttribute('fill','none');
  arc.setAttribute('stroke-linecap','round');
  eclipticLayer.appendChild(arc);

  // add zodiac glyph placeholders along arc (simple circles)
  const glyphs = 8;
  for(let i=0;i<glyphs;i++){
    const t = i/(glyphs-1);
    const ang = startAngle + (endAngle-startAngle)*t;
    const gx = cx + (r+18)*Math.cos(ang);
    const gy = cy + (r+18)*Math.sin(ang);
    const g = document.createElementNS('http://www.w3.org/2000/svg','text');
    g.setAttribute('x', gx);
    g.setAttribute('y', gy+6);
    g.setAttribute('font-size','18');
    g.setAttribute('text-anchor','middle');
    g.setAttribute('fill','rgba(255,255,255,0.7)');
    g.textContent = 'â™ˆ'; // sample glyph; could vary
    labelsLayer.appendChild(g);
  }

  // DONE â€” overlays (text etc.) updated elsewhere by updateTextFromInputs()
}

/* ------------------------
   Sync SVG overlays with form inputs
   ------------------------ */
function updateTextFromInputs(){
  document.getElementById('svgUsername').textContent = document.getElementById('username').value || '@The_Vanallenbelt';
  document.getElementById('svgHeadline').textContent = document.getElementById('headline').value || 'Your Personal Zodiac Starmap âœ¨';
  document.getElementById('svgSubheadline').textContent = document.getElementById('subheadline').value || '';
  // caption limited to two visual lines: we simply truncate length and add ellipsis
  let cap = document.getElementById('caption').value || '';
  if(cap.length>120) cap = cap.slice(0,117) + '...';
  document.getElementById('svgCaption').textContent = cap;
  document.getElementById('svgBadge').textContent = document.getElementById('badge').value || '';
  document.getElementById('svgCTA').textContent = document.getElementById('cta').value || 'Get Your Starmap';
}

/* ------------------------
   Hook up UI events
   ------------------------ */
const inputs = ['username','headline','subheadline','caption','badge','cta'];
inputs.forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('input', ()=>{
    updateTextFromInputs();
  });
});

document.getElementById('showLabels').addEventListener('change', renderAll);
document.getElementById('showLines').addEventListener('change', renderAll);

document.getElementById('presetGalaxy').addEventListener('click', ()=>{ setTheme('theme-galaxy');});
document.getElementById('presetMystic').addEventListener('click', ()=>{ setTheme('theme-mystic');});
document.getElementById('presetGolden').addEventListener('click', ()=>{ setTheme('theme-golden');});

function setTheme(className){
  document.body.classList.remove('theme-galaxy','theme-mystic','theme-golden');
  document.body.classList.add(className);
}

/* ------------------------
   Initial render & apply initial text
   ------------------------ */
updateTextFromInputs();
renderAll();

/* ------------------------
   Export functions: serialize SVG to PNG via canvas
   - svgString -> blob url -> drawImage on canvas -> toBlob -> download
   ------------------------ */

function svgToDataUrl(svgEl){
  // Clone to avoid mutating original; embed current computed styles if needed
  const clone = svgEl.cloneNode(true);

  // Inline computed fill colors from CSS variables where needed for portability
  // (basic approach: replace usage of CSS vars in relevant attributes; for this demo we keep simple)
  // Serialize
  const serializer = new XMLSerializer();
  let svgStr = serializer.serializeToString(clone);

  // Add XML declaration and svg namespace if missing
  if(!svgStr.match(/^<\?xml/)) svgStr = '<?xml version="1.0" standalone="no"?>\n' + svgStr;
  return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgStr);
}

async function downloadSVGAsPNG(svgEl, pixelSize=1080, filename='starmap.png'){
  try {
    const dataUrl = svgToDataUrl(svgEl);
    const img = new Image();
    // CORS-safe since data URL
    img.src = dataUrl;
    await new Promise((res, rej) => {
      img.onload = () => res();
      img.onerror = (e)=> rej(e);
    });

    // draw onto canvas with requested resolution
    const canvas = document.createElement('canvas');
    canvas.width = pixelSize;
    canvas.height = pixelSize;
    const ctx = canvas.getContext('2d');

    // clear bg and paint
    ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg1') || '#000';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Draw image scaled to canvas
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    // Trigger download
    await new Promise((res) => {
      canvas.toBlob(blob => {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        res();
      }, 'image/png');
    });
    return true;
  } catch(err){
    console.warn('PNG export failed:', err);
    return false;
  }
}

document.getElementById('download1080').addEventListener('click', async ()=>{
  // Before export, ensure overlay text is up to date (it is updated live)
  const ok = await downloadSVGAsPNG(document.getElementById('postSVG'), 1080, 'zodiac_starmap_1080.png');
  if(!ok){
    alert('Automatic download failed â€” opening image in new tab as fallback.');
    openInNewTab();
  }
});

document.getElementById('download3k').addEventListener('click', async ()=>{
  const ok = await downloadSVGAsPNG(document.getElementById('postSVG'), 3000, 'zodiac_starmap_3000.png');
  if(!ok){
    alert('Automatic high-res download failed â€” opening image in new tab as fallback.');
    openInNewTab(1080);
  }
});

function openInNewTab(size=1080){
  // Create data URL and open it in a new tab (browser may block popups without user gesture)
  const svgEl = document.getElementById('postSVG');
  const url = svgToDataUrl(svgEl);
  const img = new Image();
  img.src = url;
  const w = window.open("");
  if(!w){
    alert('Could not open new tab. Your browser may be blocking popups. Try the download buttons or allow popups for this page.');
    return;
  }
  // Create simple HTML to show the image at exact pixel size
  const html = `
    <!doctype html>
    <html><head><title>Export Preview</title></head>
    <body style="margin:0;background:#000;display:flex;align-items:center;justify-content:center;height:100vh;">
      <img src="${url}" style="width:${size}px;height:${size}px;box-shadow:0 12px 40px rgba(0,0,0,0.6);"/>
      <script>
        // instructions for user
        console.log('Right-click the image -> Save image as... to download at ${size}px');
      </script>
    </body></html>`;
  w.document.open();
  w.document.write(html);
  w.document.close();
}
document.getElementById('openNewTab').addEventListener('click', ()=>openInNewTab(1080));

/* Accessibility: keyboard shortcuts for quick export (Ctrl+Enter) */
window.addEventListener('keydown', (e)=>{
  if((e.ctrlKey||e.metaKey) && e.key === 'Enter'){
    document.getElementById('download1080').click();
  }
});

/* If you want to add more stars or real catalogs:
   - Replace STAR_CATALOG with a larger list of {name, ra, dec, mag}
   - Adjust projectStar / projection for different center or projection type
   - For real RA/Dec at a given datetime/location, implement sidereal time & transform from equatorial to alt/az before projecting
*/
</script>
</body>
</html>
